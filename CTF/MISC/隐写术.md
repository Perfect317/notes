# 隐写术

## 1.图形隐写方法及信息提取

### 1.0常见的图形隐写方法

**插入隐藏**在不影响载体正常使用的情况下将秘密信息插入到载体中，实现信息的隐藏，这种方法一般会导致载体文件的大小发生变化。根据插入的位置，又可分为追加插入法和前置插入法。

**追加插入法**在文件末尾附加数据，在文件结束标识后附加的数据不会被解析。

**前置插入法**利用文件头部的冗余部分进行插入，冗余部分可以是批注内容、注释信息等。

**元数据**是描述数据的数据，主要用于描述数据的属性，例如数据的名称，大小，数据类型，拥有者等。常常位于文件头部或者尾部

**替换隐藏**修改载体文件的数据，将原始载体内的不重要数据替换成要隐藏的数据，最典型的替换隐藏方法是**最低比特隐写（LSB）**



### 1.1 PNG文件格式及隐写方法

#### （1)PNG关键数据块：IHDR，IDAT，PLTE，IEND

**IHDR**是文件头数据块，包含PNG文件中存储的图像数据的基本信息，由13字节组成，并作为第一个数据块出现在PNG图像中，一个PNG图像只能有一个IHDR。

**IDAT**是图像数据块，用于存储实际的像素值数据

**PLTE**是调色版数据块，包含与索引彩色图像相关的彩色变换数据，它仅与索引彩色图形有关，而且要放在图像数据块之前，

**IEND**是数据结束块，用来标记PNG文件的结束

#### 2.图像深度是指像素值由几个比特的数据表示

例：图像深度8，也就是用8比特的无符号整数表示一个像素值，那么像素值的范围为0~255

### 1.2 JPG文件格式及隐写方法

1.**前置插入法**：Exif是在文件头中增加了有关拍摄信息的内容和索引图

2.JSteg隐写算法

### 1.3 GIF文件格式及隐写方法

**1.文件头、GIF数据流、文件结尾**

- 文件头包括**蜀名**和**版本**，蜀名为 47 49 46，其对应的ASCII码是“GIF”；版本号也由3字节组成可以是87a 或89a
- 文件结尾是固定的字节 0x3b

2.考点：

1. **追加插入法**，在GIF文件后面加上其他文件
2. **基于图像的隐写**，GIF可以包含多张图片，在某幅图像中隐写信息
3. **基于时间的隐写**，因为GIF每幅图像都会有延迟时间，可以约定不同的延迟时间代表不同的含义，已达到传输秘密信息的目的

### 1.4图像隐写三板斧

1. 010editor，strings：发现插入隐藏

   >1. 修改高度会使CRC值和IHDR中原CRC值不匹配，PNG在Windows下修改可以正常打开图片，在Lunix或者MAC下无法打开,JPG在不同操作系统中可以打开
   >
   >2. 修改后的图像不能用StegSolve打卡，用脚本破解原来尺寸
   >
   >   
   >
   >

2. StegSolve,zsteg：LSB隐写

3. binwalk，foremost：提取文件中包含的其他文件

   > 1.binwalk -e test.png
   >
   > 2.foremost test.png
   >
   > 3.stegdetect工具可以检测图像中是否存在JSteg、OutGuess、Jphide算法，
   >
   > 使用方法：
   >
   > -s 修改检测算法的灵敏度，默认是1
   >
   > -d 打印带行号的调试工具
   >
   > -t 设置要检测哪些隐写工具(默认joip)
   >
   > - j 检测JSteg
   > - o 检测OutGuess,检测outGuess还可以用kali中的命令，outguess -r test.png 2txt   将内容写到2txt中
   > - p 检测Jphide
   > - i 检测Invisible Secrets
   >
   > stegdetect.exe -t jiop -s 10 test.png 
   >
   > 例如返回Jphide(***)就是采用了Jphide加密算法，三个星号说明概率最大
   >
   > stegdetect.exe -t joip -s 10 xingkong.jpg
   >
   > stegbreak.exe -r rules.ini -f password.txt -t p test.png
   >
   > -r 包含应用于单词列表中单词的转换规则，这些规则遵循与John The Ripper相同的语法，默认为 rules.ini
   >
   > -f 指定字典
   >
   > -t 需要设置的算法
   >
   > 攻击成功时会打印文件名，嵌入系统和密钥
   >
   > 在JPHS中点击SEEK输入两边密钥，保存输出文件就可以得到flag

## 2.steghide

steghide extract -sf test.jpg -p 123456
#-sf  参数
#test.jpg  图片名称
#-p 密码参数，后面空格跟密码，无密码可不加参数，回车就好



也可以使用stegseek

世界上最快的 steghide 破解程序，每秒⚡咀嚼数百万个密码

在wsl中运行

stegseek --crack flag.jpg rockyou.txt

## GIF

### 1.延迟时间的隐写

(1)发现延迟时间不同，导出延迟时间

导出的方法	1.修改010editor gif模板

2.kali identify -format "%s %T \n"SimplerGIF.gif

可以将终端内容输入到文档中——script -f  out.txt

(2)考虑对应的延迟时间代表的意义，进行转换得到flag

## PNG 、JPG

### 1.LSB隐写

#### 1.StatSolve查看不同颜色的图片有没有隐藏其他内容，

#### 2.数据提取，选择不同颜色通道反复尝试

**zsteg** 文件.png 直接可以查看其中包含的字符串

> -  b1 表示最低位 b8表示最高位
>
> -  b表示蓝色通道，r表示红色通道，g表示绿色通道
>
> -  lsb 表示最低位是第一位，msb表示最高位是第一位
> -  xy 表示按行提取

zsteg -a 文件.png 可以尝试提取信息所有的排列组合

#### 2.修改长宽

修改后的图片不能用StegSolve打开，需要使用脚本破解出原长宽。

python2 breakwidthheight.py test.png

使用自动化工具 crc32fix.exe

#### 3.手动提取文件中包含的内容，删除该内容之前的所有内容，另存为该格式

### 2.Snow隐写

通过在文本文件末尾追加由制表位隔开的空格可以实现数据隐藏

-C

如果隐藏，则压缩数据，或者如果提取，则会解压缩。

-Q

静音模式。如果未设置，则程序报告统计信息，例如压缩百分比和可用存储空间的数量。

-S

报告文本文件中隐藏消息的近似空间量。考虑线长度，但忽略其他选项。

-p password

如果设置为此，则在隐藏期间将使用此密码加密数据，或在提取期间解密。

-l line-length

在附加空格时，Snow将始终产生比此值短的线条。默认情况下，它设置为80。

-f message-file

此文件的内容将隐藏在输入文本文件中。

-m message-string

此字符串的内容将被隐藏在输入文本文件中。请注意，除非在字符串中包含一个换行符，否则在提取邮件时，否则不会打印换行符。

### 3.音频mp3Stego

mp3Stego工具 用于提取隐藏数据

Decode.exe -X -P 密码 test.mp3